{% load static %}
<body>
    <link href='https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css' rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js" rel="stylesheet">
    <link href="{% static 'https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css' %}" rel="stylesheet">
    <link href="{% static 'comment/comment.css' %}" rel="stylesheet"> 
    <div class="container">
    <div class="be-comment-block">
        <div class="be-comment-block" id='comment-list'>
        <h1 class="comments-title">Comments (3)</h1>
        <div class="be-comment">
            <div class="be-img-comment">    
                <a href="blog-detail-2.html">
                    <img src="https://bootdey.com/img/Content/avatar/avatar1.png" alt="" class="be-ava-comment">
                </a>
            </div>
            <div class="be-comment-content">
                
                    <span class="be-comment-name">
                        <a href="blog-detail-2.html">Ravi Sah</a>
                        </span>
                    <span class="be-comment-time">
                        <i class="fa fa-clock-o"></i>
                        May 27, 2015 at 3:14am
                    </span>
    
                <p class="be-comment-text">
                    Pellentesque gravida tristique ultrices. 
                    Sed blandit varius mauris, vel volutpat urna hendrerit id. 
                    Curabitur rutrum dolor gravida turpis tristique efficitur.
                </p>
            </div>
        </div>
        <div class="be-comment">
            <div class="be-img-comment">    
                <a href="blog-detail-2.html">
                    <img src="https://bootdey.com/img/Content/avatar/avatar2.png" alt="" class="be-ava-comment">
                </a>
            </div>
            <div class="be-comment-content">
                <span class="be-comment-name">
                    <a href="blog-detail-2.html">Phoenix, the Creative Studio</a>
                </span>
                <span class="be-comment-time">
                    <i class="fa fa-clock-o"></i>
                    May 27, 2015 at 3:14am
                </span>
                <p class="be-comment-text">
                    Nunc ornare sed dolor sed mattis. In scelerisque dui a arcu mattis, at maximus eros commodo. Cras magna nunc, cursus lobortis luctus at, sollicitudin vel neque. Duis eleifend lorem non ant. Proin ut ornare lectus, vel eleifend est. Fusce hendrerit dui in turpis tristique blandit.
                </p>
            </div>
        </div>
        <div class="be-comment">
            <div class="be-img-comment">    
                <a href="blog-detail-2.html">
                    <img src="https://bootdey.com/img/Content/avatar/avatar3.png" alt="" class="be-ava-comment">
                </a>
            </div>
            <div class="be-comment-content">
                <span class="be-comment-name">
                    <a href="blog-detail-2.html">Cüneyt ŞEN</a>
                </span>
                <span class="be-comment-time">
                    <i class="fa fa-clock-o"></i>
                    May 27, 2015 at 3:14am
                </span>
                <p class="be-comment-text">
                    Cras magna nunc, cursus lobortis luctus at, sollicitudin vel neque. Duis eleifend lorem non ant
                </p>
            </div>
        </div>
        </div>
        <form class="form-block">
            <div class="row">
                <div class="col-xs-12 col-sm-6">
                    <div class="form-group fl_icon">
                        <div class="icon"><i class="fa fa-user"></i></div>
                        <input class="form-input" type="text" placeholder="Your name">
                    </div>
                </div>
                <div class="col-xs-12 col-sm-6 fl_icon">
                    <div class="form-group fl_icon">
                        <div class="icon"><i class="fa fa-envelope-o"></i></div>
                        <input class="form-input" type="text" placeholder="Your email">
                    </div>
                </div>
                <div class="col-xs-12">                                 
                    <div class="form-group">
                        <textarea class="form-input" required="" placeholder="Your text"></textarea>
                    </div>
                </div>
                <a class="btn btn-primary pull-right">submit</a>
            </div>
        </form>
    </div>
    </div>
    <script>
        fetch('/api' + window.location.pathname ,{
            method:"GET",
            headers:{
            "Content-Type":"application/json",
            "Authorization":`Bearer ${localStorage.getItem("access_token")}`
            }
            })
        .then(response => response.json())
        .then(data => {
            const productList = document.getElementById('comment-list');
            productList.innerHTML = '';
    
            data.comment.forEach(function (product) {
                const commentContainer = document.createElement('div');
                commentContainer.classList.add('be-comment');
    
                commentContainer.innerHTML = `
                <div class="be-comment-content">    
                
                    <span class="be-comment-time">
                        <i class="fa fa-clock-o"></i>
                        ${product.created_at}
                    </span>
                    <p class="be-comment-text">
                        ${product.text}
                    </p>
                    <button class="btn btn-sm btn-outline-primary like-button">Like</button>
                    <span class="like-count">${product.likes}</span>
                </div>
                
                `;
                
                productList.appendChild(commentContainer);
            });
        })
        .catch(error => console.error('Error:', error)); 

        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.like-button').forEach(button => {
                button.addEventListener('click', function() {
                    const likeCount = this.parentElement.querySelector('.like-count');
                    likeCount.textContent = parseInt(likeCount.textContent) + 1;
                });
            });
    
            const submitButton = document.querySelector('.btn-primary');
    
            submitButton.addEventListener('click', function() {
                const nameInput = document.querySelector('input[placeholder="Your name"]');
                const emailInput = document.querySelector('input[placeholder="Your email"]');
                const commentInput = document.querySelector('textarea[placeholder="Your text"]');
                
                const newComment = {
                    name: nameInput.value,
                    email: emailInput.value,
                    text: commentInput.value
                };
    
                fetch('/api' + window.location.pathname, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(newComment)
                })
                .then(response => response.json())
                .then(data => {
                    console.log('New comment added:', data);
                    window.location.reload();
                })
                .catch(error => console.error('Error:', error));
                window.location.reload();
            });
        });
    </script>
</body>